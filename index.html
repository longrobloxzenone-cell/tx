<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TÃ i Xá»‰u Firebase</title>

<style>
body{
  background:linear-gradient(to bottom,#8b0000,#000);
  color:#fff;font-family:Arial Black;text-align:center;margin:0
}
#owner{position:fixed;top:10px;left:10px;color:#ffd700;font-size:20px}
input,button{padding:8px;margin:5px;border-radius:5px;border:none}
button{cursor:pointer}
#wallet{font-size:20px;margin:10px}
#diceArea{display:flex;justify-content:center;gap:15px;margin:20px}
.dice{width:80px;height:80px;background:#fff;border-radius:12px;
display:flex;align-items:center;justify-content:center;font-size:36px;color:#000}
.chip{width:70px;height:70px;border-radius:50%;display:inline-flex;
align-items:center;justify-content:center;margin:8px;font-weight:bold;cursor:pointer}
.chip.selected{border:3px solid #ffd700}
#adminPanel{display:none;border-top:1px solid #fff;margin-top:15px;padding-top:10px}
#chatBox{width:300px;margin:auto;border:1px solid #fff;padding:5px}
#chatMessages{height:150px;overflow-y:auto;background:#222;text-align:left;padding:5px}
</style>
</head>

<body>
<div id="owner">lowt</div>

<div id="loginPanel">
  <h2>ÄÄƒng nháº­p / ÄÄƒng kÃ½</h2>
  <input id="username" placeholder="Username">
  <input id="password" type="password" placeholder="Password"><br>
  <button onclick="login()">ÄÄƒng nháº­p</button>
  <button onclick="register()">ÄÄƒng kÃ½</button>
</div>

<div id="gamePanel" style="display:none">
  <h2>Xin chÃ o <span id="userName"></span></h2>
  <button onclick="logout()">ÄÄƒng xuáº¥t</button>
  <div id="wallet">VÃ­: <span id="money">0</span> $</div>

  <div id="diceArea">
    <div class="dice" id="d1">ğŸ²</div>
    <div class="dice" id="d2">ğŸ²</div>
    <div class="dice" id="d3">ğŸ²</div>
  </div>

  <div id="result"></div>

  <div>
    <div class="chip" data-v="1000">1K</div>
    <div class="chip" data-v="5000">5K</div>
    <div class="chip" data-v="10000">10K</div>
  </div>

  <div id="betInfo">CÆ°á»£c: 0 | Chá»n: -</div>
  <button onclick="choose('TÃ i')">TÃ i</button>
  <button onclick="choose('Xá»‰u')">Xá»‰u</button>
  <button onclick="roll()">Quay</button>

  <div id="chatBox">
    <div id="chatMessages"></div>
    <input id="chatInput" placeholder="Chat...">
    <button onclick="sendChat()">Gá»­i</button>
  </div>

  <div id="adminPanel">
    <h3>ADMIN</h3>
    <button onclick="force('TÃ i')">Ã‰p TÃ i</button>
    <button onclick="force('Xá»‰u')">Ã‰p Xá»‰u</button>
    <button onclick="force(null)">Huá»· Ã©p</button>
    <button onclick="lockBet()">KhoÃ¡ cÆ°á»£c</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
import { getAuth,createUserWithEmailAndPassword,signInWithEmailAndPassword,signOut }
from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";
import { getFirestore,doc,setDoc,getDoc,updateDoc,collection,addDoc,onSnapshot }
from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyC7MuVncVnX7FRwLkqLaQHrXOYULe80QCY",
  authDomain: "mylist644.firebaseapp.com",
  projectId: "mylist644",
  storageBucket: "mylist644.firebasestorage.app",
  messagingSenderId: "185723905502",
  appId: "1:185723905502:web:efe5c0640b3a7cc992694f"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let user=null,bet=0,choice=null,forceResult=null,locked=false;

window.register=async()=>{
  let u=username.value,p=password.value;
  await createUserWithEmailAndPassword(auth,u+"@game.com",p);
  await setDoc(doc(db,"users",u),{money:50000,isAdmin:false});
  alert("ÄÄƒng kÃ½ OK");
}

window.login=async()=>{
  let u=username.value,p=password.value;
  await signInWithEmailAndPassword(auth,u+"@game.com",p);
  user=u;
  userName.innerText=u;
  loginPanel.style.display="none";
  gamePanel.style.display="block";
  loadUser();
  listenAdmin();
}

function loadUser(){
  onSnapshot(doc(db,"users",user),s=>{
    money.innerText=s.data().money.toLocaleString();
    if(s.data().isAdmin) adminPanel.style.display="block";
  });
}

document.querySelectorAll(".chip").forEach(c=>{
  c.onclick=()=>{
    bet=+c.dataset.v;
    document.querySelectorAll(".chip").forEach(x=>x.classList.remove("selected"));
    c.classList.add("selected");
    updateInfo();
  }
});

window.choose=v=>{choice=v;updateInfo()}
function updateInfo(){betInfo.innerText=`CÆ°á»£c: ${bet} | Chá»n: ${choice||"-"}`}

window.roll=async()=>{
  if(locked||!bet||!choice) return alert("KhÃ´ng há»£p lá»‡");
  let uref=doc(db,"users",user);
  let snap=await getDoc(uref);
  let moneyNow=snap.data().money;
  if(moneyNow<bet) return alert("Thiáº¿u tiá»n");

  let dice;
  if(forceResult){
    dice = forceResult==="TÃ i"?[4,4,4]:[1,1,1];
  }else{
    dice=[1,2,3].map(()=>Math.floor(Math.random()*6)+1);
  }

  [d1,d2,d3].forEach((d,i)=>d.innerText=dice[i]);
  let sum=dice.reduce((a,b)=>a+b,0);
  let rs=sum>=11?"TÃ i":"Xá»‰u";
  let win=rs===choice;

  await updateDoc(uref,{money:win?moneyNow+bet:moneyNow-bet});
  result.innerText=`${rs} (${sum})`;
}

window.force=async(v)=>{
  await setDoc(doc(db,"config","admin"),{force:v,locked},{merge:true});
}

window.lockBet=async()=>{
  locked=!locked;
  await setDoc(doc(db,"config","admin"),{locked},{merge:true});
}

function listenAdmin(){
  onSnapshot(doc(db,"config","admin"),s=>{
    if(!s.exists()) return;
    forceResult=s.data().force;
    locked=s.data().locked;
  });
}

window.sendChat=async()=>{
  if(!chatInput.value) return;
  await addDoc(collection(db,"chat"),{u:user,m:chatInput.value});
  chatInput.value="";
}

onSnapshot(collection(db,"chat"),s=>{
  chatMessages.innerHTML="";
  s.forEach(d=>{
    chatMessages.innerHTML+=`<b>${d.data().u}:</b> ${d.data().m}<br>`;
  });
});
</script>
</body>
</html>
