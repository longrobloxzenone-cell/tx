<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Tﾃi X盻疫 Firebase</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{background:#111;color:#fff;font-family:Arial;text-align:center}
input,button{padding:8px;margin:5px}
button{cursor:pointer}
#game{display:none}
</style>
</head>
<body>

<h2>TﾃI X盻U FIREBASE</h2>

<div id="auth">
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="M蘯ｭt kh蘯ｩu"><br>
  <button onclick="register()">ﾄ斉ハg kﾃｽ</button>
  <button onclick="login()">ﾄ斉ハg nh蘯ｭp</button>
  <p id="msg"></p>
</div>

<div id="game">
  <h3>Xin chﾃo: <span id="userEmail"></span></h3>
  <p>Ti盻］: <span id="money">0</span></p>
  <button onclick="logout()">ﾄ斉ハg xu蘯･t</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
import {
  getAuth,
  createUserWithEmailAndPassword,
  signInWithEmailAndPassword,
  onAuthStateChanged,
  signOut
} from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";
import {
  getFirestore,
  doc,
  setDoc,
  getDoc
} from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

/* 沐･ FIREBASE CONFIG C盻ｦA B蘯N */
const firebaseConfig = {
  apiKey: "AIzaSyC7MuVncVnX7FRwLkqLaQHrXOYULe80QCY",
  authDomain: "mylist644.firebaseapp.com",
  projectId: "mylist644",
  storageBucket: "mylist644.appspot.com",
  messagingSenderId: "185723905502",
  appId: "1:185723905502:web:efe5c0640b3a7cc992694f"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* ===== AUTH ===== */
window.register = async () => {
  const email = emailInput.value;
  const pass = passwordInput.value;
  try {
    const res = await createUserWithEmailAndPassword(auth, email, pass);
    await setDoc(doc(db, "users", res.user.uid), {
      email,
      money: 500000,
      createdAt: Date.now()
    });
    msg.innerText = "笨 ﾄ斉ハg kﾃｽ thﾃnh cﾃｴng";
  } catch (e) {
    msg.innerText = e.message;
  }
};

window.login = async () => {
  try {
    await signInWithEmailAndPassword(auth, emailInput.value, passwordInput.value);
  } catch (e) {
    msg.innerText = e.message;
  }
};

window.logout = () => signOut(auth);

/* ===== STATE ===== */
onAuthStateChanged(auth, async user => {
  if (!user) {
    authDiv.style.display = "block";
    gameDiv.style.display = "none";
    return;
  }

  authDiv.style.display = "none";
  gameDiv.style.display = "block";
  userEmail.innerText = user.email;

  const ref = doc(db, "users", user.uid);
  const snap = await getDoc(ref);

  if (!snap.exists()) {
    await setDoc(ref, { email: user.email, money: 500000 });
    money.innerText = "500000";
  } else {
    money.innerText = snap.data().money;
  }
});

/* ===== DOM ===== */
const emailInput = document.getElementById("email");
const passwordInput = document.getElementById("password");
const authDiv = document.getElementById("auth");
const gameDiv = document.getElementById("game");
const userEmail = document.getElementById("userEmail");
const money = document.getElementById("money");
const msg = document.getElementById("msg");
</script>
</body>
</html>
